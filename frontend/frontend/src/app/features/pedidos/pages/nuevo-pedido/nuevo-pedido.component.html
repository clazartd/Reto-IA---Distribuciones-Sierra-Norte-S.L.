<div class="p-4 rounded shadow bg-white">
  <h2 class="mb-4 text-center">Nuevo pedido</h2>

  @if (statusMessage) {
    <div class="alert alert-success" role="alert">{{ statusMessage }}</div>
  }
  @if (errorMessage) {
    <div class="alert alert-danger" role="alert">{{ errorMessage }}</div>
  }

  <form [formGroup]="pedidoForm" (ngSubmit)="submit()">
    <div class="mb-3">
      <label for="cliente" class="form-label">Cliente</label>
      <input id="cliente" type="text" class="form-control" formControlName="cliente" [class.is-invalid]="pedidoForm.get('cliente')?.invalid && pedidoForm.get('cliente')?.touched">
      @if (pedidoForm.get('cliente')?.invalid && pedidoForm.get('cliente')?.touched) {
        <div class="invalid-feedback">
          Este campo es obligatorio
        </div>
      }
    </div>

    <div formArrayName="productos" class="mb-3">
      <label class="form-label">Productos</label>
      <div *ngFor="let grupo of productos.controls; let i = index" [formGroupName]="i" class="row align-items-end g-2 mb-2">
        <div class="col-7">
          <input type="text" class="form-control" formControlName="producto" placeholder="Producto" [class.is-invalid]="grupo.get('producto')?.invalid && grupo.get('producto')?.touched">
          @if (grupo.get('producto')?.invalid && grupo.get('producto')?.touched) {
            <div class="invalid-feedback">
              Indica producto
            </div>
          }
        </div>
        <div class="col-3">
          <input type="number" min="1" class="form-control" formControlName="cantidad" placeholder="Cantidad" [class.is-invalid]="grupo.get('cantidad')?.invalid && grupo.get('cantidad')?.touched">
          @if (grupo.get('cantidad')?.invalid && grupo.get('cantidad')?.touched) {
            <div class="invalid-feedback">
              Introduce una cantidad válida
            </div>
          }
        </div>
        <div class="col-2 text-end">
          <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeProducto(i)" [disabled]="productos.length === 1" title="Eliminar producto">&minus;</button>
        </div>
      </div>
      <button type="button" class="btn btn-secondary btn-sm" (click)="addProducto()">+ Añadir producto</button>
    </div>

    <div class="mb-3">
      <label for="fechaEntrega" class="form-label">Fecha prevista de entrega</label>
      <input id="fechaEntrega" type="date" class="form-control" formControlName="fechaEntrega" [class.is-invalid]="pedidoForm.get('fechaEntrega')?.invalid && pedidoForm.get('fechaEntrega')?.touched">
      @if (pedidoForm.get('fechaEntrega')?.invalid && pedidoForm.get('fechaEntrega')?.touched) {
        <div class="invalid-feedback">
          Este campo es obligatorio
        </div>
      }
    </div>

    <button type="submit" class="btn btn-primary w-100" [disabled]="pedidoForm.invalid">
      Guardar pedido
    </button>
  </form>
</div>
