<div class="pedidos-header d-flex align-items-center justify-content-between mb-4">
  <h1 class="display-5 fw-bold mb-0">Listado de Pedidos</h1>
  <app-agregar-pedido-button></app-agregar-pedido-button>
</div>

<div class="pedidos-box pedidos-filtros bg-white rounded-4 shadow-sm border p-4 mb-4">
  <form class="row g-3 align-items-center flex-nowrap">
    <div class="col flex-grow-1">
      <input type="search" [(ngModel)]="busqueda" name="busqueda" class="form-control" placeholder="&#128269; Buscar por nÃºmero de pedido o cliente..." autocomplete="off" (ngModelChange)="onBusquedaChange()">
    </div>
    <div class="col-auto">
      <select class="form-select" [(ngModel)]="filtroEstado" name="filtroEstado" style="min-width:120px;" (ngModelChange)="onFiltroEstadoChange()">
        <option value="">Todos</option>
        <option value="REGISTRADO">Registrado</option>
        <option value="PREPARACION">PreparaciÃ³n</option>
        <option value="REPARTO">Reparto</option>
        <option value="ENTREGADO">Entregado</option>
        <option value="CANCELADO">Cancelado</option>
      </select>
    </div>
  </form>
  <div class="text-muted mt-1 ms-1" style="font-size:.97em;">
    Mostrando {{ pedidosFiltrados.length || 0 }} de {{ pedidos.length || 0 }} pedidos
  </div>
</div>

<div class="pedidos-box bg-white rounded-4 shadow-sm border p-4">
  <div class="fw-bold fs-5 mb-3">Listado de Pedidos</div>
  <div *ngIf="loading" class="mt-4">
    <div class="alert alert-secondary text-center">
      <span class="spinner-border spinner-border-sm me-2"></span>
      Cargando pedidos...
    </div>
  </div>
  <div *ngIf="error && !loading" class="mt-4">
    <div class="alert alert-danger text-center">{{ error }}</div>
  </div>
  <div *ngIf="!loading && !error">
    <div class="table-responsive">
      <table class="table mb-0 align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>NÃºmero</th>
            <th>Cliente</th>
            <th>Fecha solicitud</th>
            <th>Fecha prevista</th>
            <th>Estado</th>
            <th>Urgente</th>
            <th>Total (â‚¬)</th>
            <!-- AquÃ­ podrÃ­an ir acciones si aplica -->
          </tr>
        </thead>
        <tbody *ngIf="pedidosFiltrados.length">
          <tr *ngFor="let pedido of pedidosFiltrados">
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.numeroPedido }}</td>
            <td>{{ getClienteNombre(pedido.clienteId) || '-' }}</td>
            <td>{{ pedido.fechaSolicitud | date: 'dd/MM/yyyy' }}</td>
            <td>{{ pedido.fechaPrevistaEntrega | date: 'dd/MM/yyyy' }}</td>
            <td>
              <span class="badge rounded-pill"
                [ngClass]="{
                  'bg-secondary-subtle text-dark': pedido.estado === 'REGISTRADO',
                  'bg-warning-subtle text-warning fw-semibold px-3': pedido.estado === 'PREPARACION',
                  'bg-primary-subtle text-primary fw-semibold px-3': pedido.estado === 'REPARTO',
                  'bg-success-subtle text-success fw-semibold px-3': pedido.estado === 'ENTREGADO',
                  'bg-danger-subtle text-danger fw-semibold px-3': pedido.estado === 'CANCELADO'
                }">
                {{
                  pedido.estado === 'REGISTRADO' ? 'Registrado' :
                  pedido.estado === 'PREPARACION' ? 'PreparaciÃ³n' :
                  pedido.estado === 'REPARTO' ? 'Reparto' :
                  pedido.estado === 'ENTREGADO' ? 'Entregado' :
                  pedido.estado === 'CANCELADO' ? 'Cancelado' : pedido.estado
                }}
              </span>
            </td>
            <td class="text-center">
              <span *ngIf="pedido.urgente" title="Urgente" style="font-size: 1.6em; line-height: 1;">
                ðŸš¨
              </span>
            </td>
            <td>{{ pedido.total | number:'1.2-2' }}</td>
            <!-- Acciones (editar/eliminar) pueden ir aquÃ­ si es requerido mÃ¡s tarde -->
          </tr>
        </tbody>
      </table>
      <ng-template #sinPedidos>
        <tr>
          <td colspan="8" class="text-center text-muted py-5">
            No hay pedidos para mostrar.
          </td>
        </tr>
      </ng-template>
    </div>
  </div>
</div>
