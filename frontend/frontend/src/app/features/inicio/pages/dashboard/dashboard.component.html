<section>
  <h2 class="fw-bold">Panel de Control</h2>
  <div class="text-muted mb-4">
    Bienvenido, {{ usuario?.nombre || usuario?.username || '' }}. Resumen de la actividad del sistema.
  </div>
</section>

<!-- CARDS DE RESUMEN -->
<section class="row g-3 mb-4">
  <div class="col-12 col-sm-6 col-lg-4">
    <div class="summary-card card h-100">
      <div class="card-body">
        <h6 class="card-title">Total Pedidos</h6>
        <div class="display-5">{{ resumen.registrados + resumen.preparados + resumen.enReparto + resumen.entregados + resumen.cancelados }}</div>
        <small class="text-muted">En el sistema</small>
      </div>
    </div>
  </div>
  <div class="col-12 col-sm-6 col-lg-4">
    <div class="summary-card card h-100">
      <div class="card-body">
        <h6 class="card-title">Pedidos Pendientes</h6>
        <div class="display-5">{{ resumen.registrados }}</div>
        <small class="text-muted">En proceso</small>
      </div>
    </div>
  </div>
  <div class="col-12 col-sm-6 col-lg-4">
    <div class="summary-card card h-100">
      <div class="card-body">
        <h6 class="card-title">Entregas Hoy</h6>
        <div class="display-5">{{ resumen.entregados }}</div>
        <small class="text-muted">Programadas</small>
      </div>
    </div>
  </div>
</section>

<!-- DISTRIBUCIÓN POR ESTADO -->
<section class="mb-4">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title mb-2">Distribución de Pedidos por Estado</h6>
      <div class="text-muted mb-2">
        Vista general del estado actual de todos los pedidos
      </div>
      <div *ngIf="!isLoadingEstados && distribucionPorEstado && totalEstadosPedidos > 0; else estadoVacio">
        <table class="table table-borderless align-middle mb-0">
          <tbody>
            <tr *ngFor="let estado of estadosPedidos">
              <td style="white-space:nowrap; width:120px;">
                <span class="fw-semibold"
                  [ngClass]="{
                    'text-secondary': estado === 'REGISTRADO',
                    'text-warning': estado === 'PREPARACION',
                    'text-primary': estado === 'REPARTO',
                    'text-success': estado === 'ENTREGADO',
                    'text-danger': estado === 'CANCELADO'
                  }">{{
                    estado === 'REGISTRADO' ? 'Registrado'
                    : estado === 'PREPARACION' ? 'Preparación'
                    : estado === 'REPARTO' ? 'Reparto'
                    : estado === 'ENTREGADO' ? 'Entregado'
                    : estado === 'CANCELADO' ? 'Cancelado'
                    : estado
                  }}</span>
              </td>
              <td style="width:60px;" class="text-end fw-semibold">
                {{ distribucionPorEstado[estado] || 0 }}
              </td>
              <td style="width:75%">
                <div class="progress" style="height:10px;">
                  <div
                    class="progress-bar"
                    [ngClass]="{
                      'bg-secondary': estado === 'REGISTRADO',
                      'bg-warning': estado === 'PREPARACION',
                      'bg-primary': estado === 'REPARTO',
                      'bg-success': estado === 'ENTREGADO',
                      'bg-danger': estado === 'CANCELADO'
                    }"
                    [style.width.%]="getPorcentajeEstado(estado)">
                  </div>
                </div>
              </td>
              <td style="width:50px;" class="text-end">
                <span class="text-muted small">{{ getPorcentajeEstado(estado) | number:'1.0-0' }}%</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #estadoVacio>
        <div class="text-center text-muted py-3">No hay pedidos registrados</div>
      </ng-template>
    </div>
  </div>
</section>

<!-- ACCIONES RÁPIDAS (cards explicativas por rol) -->
<section>
  <div class="card mb-2">
    <div class="card-body">
      <h6 class="card-title mb-2">Acciones Rápidas</h6>
      <div class="text-muted mb-3">Accede a las funciones principales del sistema</div>
      <div class="row g-3">
        
        <div class="col-12 col-md-3 d-flex">
          <a class="btn btn-outline-secondary flex-fill" routerLink="/pedidos/listado">Ver Pedidos</a>
        </div>
        <div class="col-12 col-md-3 d-flex">
          <a class="btn btn-outline-secondary flex-fill" routerLink="/clientes">Gestionar Clientes</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Cards explicativas por rol (solo visible si el usuario tiene el rol correspondiente) -->
  <div *ngIf="esComercial" class="card mt-3">
    <div class="card-body">
      <h6>Comercial</h6>
      <p class="mb-0 text-muted">Puede registrar nuevos pedidos, ver sus pedidos y planificar rutas de entrega.</p>
    </div>
  </div>
  <div *ngIf="esAlmacen" class="card mt-3">
    <div class="card-body">
      <h6>Almacén</h6>
      <p class="mb-0 text-muted">Gestiona la preparación de pedidos y el inventario de productos.</p>
    </div>
  </div>
  <div *ngIf="esReparto" class="card mt-3">
    <div class="card-body">
      <h6>Reparto</h6>
      <p class="mb-0 text-muted">Accede a la lista de entregas asignadas y confirma las entregas realizadas.</p>
    </div>
  </div>
  <div *ngIf="esDireccion" class="card mt-3">
    <div class="card-body">
      <h6>Dirección</h6>
      <p class="mb-0 text-muted">Dispone de visión global para toma de decisiones y acceso a informes históricos.</p>
    </div>
  </div>
</section>
